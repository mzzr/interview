# TCP/IP常见面试题

## TCP 协议

1. OSI与TCP/IP各层的结构和功能，协议和作用
OSI七层模型对应TCP/IP四层模型，只是分法不同而已。
应用层：提供应用层服务，文件传输（FTP），电子邮件（smtp），主要的协议还有HTTP（超文本传输协议），DNS，和telnet
表示层：用于数据格式化，代码转换，数据加密，没有协议
会话层：解除或建立与别的节点的联系，没有协议
传输层：TCP UDP
网络层：IP ICMP（ping主要实现），ISPF（全局泛洪，主要用于IP选路）
数据链路层：ARP（地址解析协议，根据IP地址获得MAC地址）
物理层
传输层：四层交换机
网络层：路由器、三层交换机
数据链路层：网桥、以太网交换机（二层交换机）、网卡
物理层：中继器、集线器、双绞线

2. TCP和UDP有什么区别
TCP是传输控制协议，提供的是面向连接的，可靠地字节流服务。实际数据传输之前服务器和客户端需要进行三次握手，会话结束后结束连接。UDP是用户数据报协议，是无连接的。因为无连接，而且没有超时重发机制，所以UDP传输速度很快。主要用于视频传输，实时视频
TCP保证数据按序到达，提供流量控制和拥塞控制，在网络拥堵的时候会减慢发送字节数，而UDP不管网络是否拥堵。
TCP是连接的，所以服务是一对一服务，而UDP可以1对1，也可以1对多，也可以多对多

3. TCP 的三次握手
假设A是客户端，B是服务端。A首先向B发出连接请求报文段，这个时候首部中的同步位SYN=1，同时选择一个初始的序号x。此时报文段不能携带数据。此时A进入到SYN_SENT状态。
B收到连接请求报文，同意建立连接，向A发出确认。确认报文中，SYN和ACK都置1，确认号为x+1，与此同时，自己选择一个初始序号y，这个报文也不携带数据，此时B进入SYN_RECVD状态。
A收到B确认后，还要给B确认。这时可以携带数据，A进入到ESTABLISHED状态。这就是三次握手的过程。

4. 如果两次握手，会如何
A发送一次确认，主要是为了防止已经失效的连接请求报文又突然传送到了B，而产生错误。假设一种异常，A发出的请求由于网络阻塞没有及时到达B，后又重传请求，之后B响应了，且建立了连接，之后连接又释放了。此时假设A发出的第一个请求到达B，B误以为是A再次发送请求连接，B建立连接，如果采用两次握手，此时连接建立，而A又不发送数据，浪费了B的资源。

5. TCP的四次挥手
数据传输结束后，通信双方都可以释放连接。现在A和B都处于ESTABLISHED状态，A的应用程序向其TCP发出连接释放报文段，主动关闭TCP连接。A进入FIN_WAIT1，然后B确认，B进入CLOSE_WAIT。此时TCP处于半关闭状态，A收到B的确认后，进入FIN_WAIT2，等待B发出连接释放报文。如果B已经没有向A发送的数据，则B发送请求释放报文，B进入LAST_ACK，等待A的确认。A在收到B的请求以后，要发出确认，然后进入TIME_WAIT状态。此时，连接还未释放，必须等待时间等待计时器设定的时间的2MSL后，A才进入CLOSED状态。

6. 为什么要等一个TIME_WAIT时间呢？
为了保证最后一个ACK能够到达B，防止丢失了，B重传，A不能回复确认。二是防止已经失效的连接请求报文段出现在连接中。A发送完最后一个ACK，再经过时间2MSL，可以使本连接产生的所有请求报文从网络中消失。

7. TCP拥塞控制
拥塞控制就是防止过多的数据注入到网络中，这样使得网络中的路由器或者链路不至于过载。TCP拥塞控制方法主要包括：慢开始，拥塞避免，快重传和快恢复。
慢开始是指发送方先设置cwnd=1，一次发送一个报文段，随后每经过一个传输轮次，拥塞串口cwnd就加倍，其实增长并不慢，以指数形式增长。还要设定一个慢开始门限，当cwnd>门限值，改用拥塞避免算法。拥塞避免算法使cwnd按线性规律缓慢增长。当网络发生延时，门限值减半，拥塞窗口执行慢开始算法。
当接收方收到失序的报文段，按照快重传，需要尽快发送对未收到的报文段的重复确认，快恢复是指当拥塞窗口达到门限值，不直接开启慢启动算法，而是快恢复，收到三个重复的确认，此时并不执行慢开始算法，而是执行快恢复，就是新的门限是原来的一半，直接进入拥塞避免阶段。

8. 滑动窗口协议和回退n帧协议
发送方和接收方都维护一个数据帧序列，这个序列叫窗口。
发送方的窗口由接收方确定，目的在于控制发送速度，以免接收方缓存不够大，而导致溢出。窗口不断根据ACK进行滑动
滑动窗口是理论，可以用的是后退n帧协议。发送方一次发送比如说10个帧，前两个帧都返回了对应的ACK，数据帧2出现了错误，这时发送方被迫重新发送2-8这七个帧，这就是回退n帧协议。
选择重传协议

