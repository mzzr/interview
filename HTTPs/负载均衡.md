# 负载均衡
## OSI七层模型
应用层-表示层-会话层-传输层-网络层-数据链路层-物理层
## TCP/IP模型
应用层-传输层-网络层-网络接口层
## 负载均衡的类别
根据负载均衡所作用在OSI模型的位置不同，负载均衡可以大概分为以下几类：
- 二层负载均衡(mac)
根据OSI模型中的二层负载，一般是用虚拟mac地址方式，外部对虚拟MAC地址请求，负载均衡接收后分配后端实际的MAC地址响应。
- 三层负载均衡(ip)
一般采用虚拟IP地址方式，外部对虚拟得到ip地址请求，负载均衡接收后分配后端实际的IP地址响应。
- 四层负载均衡(tcp)
在三层负载均衡的基础上，用ip+port接收请求，再转发到对应的机器。
- 七层负载均衡(http)
根据虚拟的url或IP，主机名接收请求，再转向相应的处理服务器。
## 四层负载均衡（基于IP+端口的负载均衡）
四层负载均衡，也就是主要通过报文中的目标地址和端口，再加上负载均衡设备的服务器选择方式，决定最终选择的内部服务器。
起到一个类似路由转发的作用，client->server修改目标ip地址，server->client修改源地址
**总而言之，四层负载均衡只会解析到四层协议栈，通过修改数据包的地址信息（IP+端口号）进行透明转发**
**基于IP+端口的负载均衡**
## 七层负载均衡（基于虚拟的URL或主机IP的负载均衡）
七层负载均衡，也称为“内容交换”，也就是主要通过报文中的真正有意义的应用层内容，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。
**相当于一个代理服务器，负载均衡器和前端的客户端以及后端的服务器分别建立TCP连接**
## 四层和七层LB的最大区别
- 四层LB基于ip+port，七层LB基于虚拟URL或主机IP
- 四层LB相当于路由器，七层LB相当于一个代理服务器
- 四层负载架构设计比较简单，无需解析具体的消息内容，在网络吞吐量及处理能力上会相对比较高，而七层负载均衡的优势则体现在功能多，控制灵活强大。